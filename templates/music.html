{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Streaming Service</title>
    <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body style="margin:0; padding:0; background:#121212; font-family:Arial, sans-serif; color:#fff;">
    <!-- Sidebar remains unchanged -->
    <div class="sidebar">

        <div class="sidebar-section">
          <!-- Spotify Logo -->
          <img src="https://storage.googleapis.com/pr-newsroom-wp/1/2018/11/Spotify_Logo_RGB_Green.png" alt="Spotify Logo"
            style="width: 100%; height: auto; padding: 20px; box-sizing: border-box;">
    
          <a href="/" class="sidebar-link">
            <span class="sidebar-link-icon"><i class="fa-solid fa-house"></i></span>
            Home
          </a>
          <a href="/search" class="sidebar-link">
            <span class="sidebar-link-icon"><i class="fa-solid fa-magnifying-glass"></i></span>
            Search
          </a>
        </div>
    
        <!-- Bottom section of the sidebar -->
        <div class="sidebar-section">
          <a href="#" class="sidebar-link">
            <span class="sidebar-link-icon"><i class="fa-solid fa-book"></i></span>
            Your Library
          </a>
          <div class="create-playlist">
            <h4>Create your first playlist</h4>
            <p>It easy we will help you</p>
            <button>Create playlist</button>
          </div>
        </div>
    
        <div class="sidebar-section">
          <a href="#" class="sidebar-link">
            <span class="sidebar-link-icon"><i class="fa-solid fa-heart"></i></span>
            Liked Songs
          </a>
          <a href="#" class="sidebar-link">
            <span class="sidebar-link-icon"><i class="fa-brands fa-itunes-note"></i></span>
            US-UK Top Charts
          </a>
        </div>
      </div>

    <!-- Main content area where we will add the music player -->
    <div class="music-player"
        style="margin-left:240px; padding:20px; display: flex; justify-content: center; align-items: center; height: calc(100vh - 90px);">
        <!-- Music Player Interface -->
        <div class="player-container">
            <img class="album-cover" src="{{image}}" alt="Album Cover">
            <div class="song-info">
                <h2 class="song-title">{{name_track}}</h2>
                <h3 class="artist-name">{{artists}}</h3>
            </div>
            <div class="player-controls">
                <button id="prev" class="control-btn">&#9668;</button>
                <button id="play-pause" class="control-btn play-btn">&#9658;</button>
                <button id="next" class="control-btn">&#9658;</button>
            </div>
            <div class="progress-bar" id="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <div class="time-stamps">
                <span id="current-time">0:00</span>
                <span id="total-duration">4:00</span>
            </div>
            <audio>
                <!-- <source src="{{preview_url}}" type="audio/mpeg"> -->
                Your browser does not support the audio element.
            </audio>
        </div>

        <!--<audio id="audio-player" src="{% static 'audio-source-url' %}"></audio>-->
    </div>
</body>
<script src="https://sdk.scdn.co/spotify-player.js"></script>
    <script>


        window.onSpotifyWebPlaybackSDKReady = () => {
            const token = 'BQB-hjK_laWCNy_GLgNIPU5WHFvi1KuKFiwpu6HlfnxT5Uo6188KPCWYScBBtD8-_sHfhhUAiYas0hTPSA27XI85o098yxA8W6JRD2ji6a0KE5KpQwtym3wBMpGBtmNjDkYFFsf2FoPSZ5iYaYdeEd_C1kEBYRlNoLAqX9-TavGVuZTcwJ7M9wJWS1wAlDcsMr10ahC2Wbm8l3KNZIQvuCxhmtb4qbKp-PTxRQ';
            const player = new Spotify.Player({
                name: 'Web Playback SDK Quick Start Player',
                getOAuthToken: cb => { cb(token); },
                volume:1,
                uri: 'spotify:track:{{uri}}'
            });

            // Ready
            player.addListener('ready', ({ device_id }) => {
                console.log('Ready with Device ID', device_id);
            });

            // Not Ready
            player.addListener('not_ready', ({ device_id }) => {
                console.log('Device ID has gone offline', device_id);
            });

            player.addListener('initialization_error', ({ message }) => {
                console.error(message);
            });

            player.addListener('authentication_error', ({ message }) => {
                console.error(message);
            });

            player.addListener('account_error', ({ message }) => {
                console.error(message);
            });

            player.getCurrentState().then(state => {
              if (!state) {
                console.error('User is not playing music through the Web Playback SDK');
                return;
              }

              var current_track = state.track_window.current_track;
              var next_track = state.track_window.next_tracks[0];

              console.log('Currently Playing', current_track);
              console.log('Playing Next', next_track);
            });

            document.getElementById('play-pause').onclick = function() {
              // Use the Spotify Web API to set the next track
            fetch('https://api.spotify.com/v1/me/player/play', {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    uris: ['spotify:track:31VNCmwspR7nVJ6kruUuJt']
                })
            })
            .then(response => response.json())
            .then(data => console.log('Track loaded and playing', data))
            .catch(error => console.error('Error loading track', error));
              player.nextTrack();
            };

            player.connect();
        }
    </script>
</html>